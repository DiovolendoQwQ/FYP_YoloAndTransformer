# 2025-11-26

- 修复评估基线目录混淆，分别写入并读取基线与注意力版本的 `predictions.json`，避免使用最新目录：`scripts/inject_cbam_yolov8.py:82-83`、`scripts/inject_cbam_yolov8.py:95-112`
- 扩展命令行参数，统一训练与验证的配置：`--data/--epochs/--batch/--imgsz/--device/--conf/--iou`，代码位置：`scripts/inject_cbam_yolov8.py:60-69`
- 新增阈值扫描开关与列表：`--sweep/--sweep_confs`，输出关键指标与预测 JSON，代码位置：`scripts/inject_cbam_yolov8.py:114-129`
- 增强 CBAM 模块：支持 `residual_scale` 残差友好输出；参数可配 `reduction/min_size/residual_scale`，代码位置：`modules/cbam.py:4-23`、`modules/cbam.py:24-41`
- 支持通过 CLI 指定 CBAM 目标层并替换 C2f：`--cbam_layers`（如 `model.18,model.21`），代码位置：`scripts/inject_cbam_yolov8.py:15-26`、`scripts/inject_cbam_yolov8.py:71-73`
- 接入 Transformer 注意力模块：新增 `modules/transformer.py`，支持 `--attn transformer` 与超参 `--tr_heads/--tr_ff/--tr_dropout/--tr_min_size/--tr_residual_scale`，替换指定 C2f 层，代码位置：`modules/transformer.py:1-53`、`scripts/inject_cbam_yolov8.py:28-40`、`scripts/inject_cbam_yolov8.py:60-69`
- 训练目录命名自动化：`exp/日期_训练模型_第N次训练`（`yolo` 或 `yolo+transform`），依据当日同模型类型历史自增 `N`，代码位置：`scripts/inject_cbam_yolov8.py:86`
- 同步验证输出目录命名：`runs/detect/日期_训练模型_第N次训练`，阈值扫描附加 `_cXX` 后缀，代码位置：`scripts/inject_cbam_yolov8.py:106-107`、`scripts/inject_cbam_yolov8.py:114-129`
- 创建并验证 GPU 环境：`conda create -n yolo-cuda python=3.10`；安装 `pytorch-cuda=12.1`、`ultralytics`、`pycocotools`、`scipy`；`torch.cuda.is_available=True` 且 `CUDA=12.1`
- 最小验证（流程回归，非真实结论）：在 `coco128` 上以 `epochs=1` 比对基线与注意力版本；日志显示 GPU 已启用、目录命名正确、评估输出落在同步命名的验证目录。
- 后续建议：
  - 在真实数据集上以同参对比，训练轮次提升到 50–100（小数据）或 100–300（中/大数据）
  - 小目标数据增强（过采样、Copy-Paste）、提高分辨率（如 800/960）、消融注意力位置与强度
16→  - 验证集上扫 `conf` 与 `iou`，选择最佳阈值用于部署

# 2025-11-27

- 默认推理阈值调整为 `conf=0.205`，与 F1 峰值一致（`scripts/inject_cbam_yolov8.py:83`）
- 新增数据集根路径参数 `--dataset_root`，运行时自动生成并使用 `datasets/runtime_coco128.yaml`（避免远程下载与路径错误）
- 新增仅注意力训练开关 `--only_attn`，跳过基线直接训练并验证注意力版本
- 新增双模型统一输出模式 `--dual_out`：
  - 根目录命名 `YYYY-MM-DD_2模型训练_第N次训练`（自动自增 `N`）
  - 子目录命名 `yolo_epoch{E}` 与 `yolo+transform_epoch{E}`（`E` 为训练轮次）
  - 自动生成对比曲线：`compare_train/val_box_loss.png`、`compare_train/val_cls_loss.png`、`compare_train/val_dfl_loss.png`、`compare_precision.png`、`compare_recall.png`、`compare_map50.png`、`compare_map50-95.png`
  - 验证目录拷贝 PR/F1/Precision/Recall–Confidence 曲线与混淆矩阵到统一根目录
- 训练与分析（`epochs=200`，`imgsz=640`，`conf=0.205`，`coco128`）：
  - YOLO（最后一轮）：Precision≈0.922、Recall≈0.852、mAP50≈0.919、mAP50-95≈0.784，验证损失更低
  - YOLO+Transform（最后一轮）：Precision≈0.897、Recall≈0.836、mAP50≈0.898、mAP50-95≈0.690
  - 结论：在 `coco128` 小数据上，YOLO 基线整体优于注意力版本；建议在更大数据集与更高分辨率上重试并细调注意力超参
- 命名优化：支持将 `exp/2025-11-27_2模型训练1` 重命名为 `exp/2025-11-27_2模型训练_第1次训练`，后续运行自动递增
