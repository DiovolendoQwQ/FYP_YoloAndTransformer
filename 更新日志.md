# 2025-11-26

- 修复评估基线目录混淆，分别写入并读取基线与注意力版本的 `predictions.json`，避免使用最新目录：`scripts/inject_cbam_yolov8.py:82-83`、`scripts/inject_cbam_yolov8.py:95-112`
- 扩展命令行参数，统一训练与验证的配置：`--data/--epochs/--batch/--imgsz/--device/--conf/--iou`，代码位置：`scripts/inject_cbam_yolov8.py:60-69`
- 新增阈值扫描开关与列表：`--sweep/--sweep_confs`，输出关键指标与预测 JSON，代码位置：`scripts/inject_cbam_yolov8.py:114-129`
- 增强 CBAM 模块：支持 `residual_scale` 残差友好输出；参数可配 `reduction/min_size/residual_scale`，代码位置：`modules/cbam.py:4-23`、`modules/cbam.py:24-41`
- 支持通过 CLI 指定 CBAM 目标层并替换 C2f：`--cbam_layers`（如 `model.18,model.21`），代码位置：`scripts/inject_cbam_yolov8.py:15-26`、`scripts/inject_cbam_yolov8.py:71-73`
- 接入 Transformer 注意力模块：新增 `modules/transformer.py`，支持 `--attn transformer` 与超参 `--tr_heads/--tr_ff/--tr_dropout/--tr_min_size/--tr_residual_scale`，替换指定 C2f 层，代码位置：`modules/transformer.py:1-53`、`scripts/inject_cbam_yolov8.py:28-40`、`scripts/inject_cbam_yolov8.py:60-69`
- 训练目录命名自动化：`exp/日期_训练模型_第N次训练`（`yolo` 或 `yolo+transform`），依据当日同模型类型历史自增 `N`，代码位置：`scripts/inject_cbam_yolov8.py:86`
- 同步验证输出目录命名：`runs/detect/日期_训练模型_第N次训练`，阈值扫描附加 `_cXX` 后缀，代码位置：`scripts/inject_cbam_yolov8.py:106-107`、`scripts/inject_cbam_yolov8.py:114-129`
- 创建并验证 GPU 环境：`conda create -n yolo-cuda python=3.10`；安装 `pytorch-cuda=12.1`、`ultralytics`、`pycocotools`、`scipy`；`torch.cuda.is_available=True` 且 `CUDA=12.1`
- 最小验证（流程回归，非真实结论）：在 `coco128` 上以 `epochs=1` 比对基线与注意力版本；日志显示 GPU 已启用、目录命名正确、评估输出落在同步命名的验证目录。
- 后续建议：
  - 在真实数据集上以同参对比，训练轮次提升到 50–100（小数据）或 100–300（中/大数据）
  - 小目标数据增强（过采样、Copy-Paste）、提高分辨率（如 800/960）、消融注意力位置与强度
  - 验证集上扫 `conf` 与 `iou`，选择最佳阈值用于部署

